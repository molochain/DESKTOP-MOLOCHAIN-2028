# MoloChain – Production Infrastructure Report  
_For Replit Agent Integration & Project Alignment_  
**Date:** 2025-12-06  
**Prepared for:** Replit Optimization Agent  
**Prepared by:** Molochain / Afshin Movassi

---

# 1. Server Overview
**Operating System:** AlmaLinux 9.7 (RHEL-based)  
**Kernel:** 5.14.x  
**RAM:** ~8 GB  
**Swap:** ~8 GB  
**Disk:** 152 GB total (45% used)  
**Location:** Turkey (Istanbul)  
**Panel:** Plesk (nginx reverse proxy + Apache + PHP-FPM)

---

# 2. Installed Runtimes & Tools
| Component | Version | Notes |
|----------|---------|-------|
| Node.js | v20.19.6 | Used for frontend builds and future backend services |
| npm | 10.8.2 | Modern package tooling |
| PHP | 8.4.15 | For Laravel CMS (Filament) |
| MariaDB | 10.5.29 | For CMS database |
| PostgreSQL | 13.22 | For OTMS / core backend |
| nginx | 1.28.0 | Front-facing reverse proxy |
| Apache | 2.4.62 | Used for PHP apps |

---

# 3. Project Architecture (High Level)

MoloChain consists of **three major deployed components**:

---

## 3.1. Frontend (React + Vite SPA)
**Domain:** https://molochain.com  
**Path:**  
```
/var/www/vhosts/molochain.com/molochain-core/client
```

**Build command:**  
```
npm run build
```

**Build output:**  
```
/var/www/vhosts/molochain.com/molochain-core/dist/public/*
```

**Deployment target:**  
```
/var/www/vhosts/molochain.com/httpdocs
```

⚠️ Notes for Replit:  
- Very large SPA (~3MB uncompressed)  
- Needs optimization: code-splitting, lazy-loading, cleaning unused modules  
- API endpoints must be environment-configurable  
- SPA uses history routing → must be compatible with nginx rewrite rules  

---

## 3.2. CMS (Laravel + Filament)
**Domain:** https://cms.molochain.com  
**Path:**  
```
/var/www/vhosts/molochain.com/cms.molochain.com
```

**Language:** PHP 8.4  
**Database:** MariaDB (`molochain_cms`)  
**Purpose:**  
- Manage pages  
- Manage services metadata  
- Expose REST API for frontend  

### CMS API Endpoints:

**Public:**
- `GET /api/pages`
- `GET /api/pages/{slug}`  
- `GET /api/services` *(to be added soon)*

**Auth:**
- `POST /api/auth/login`  
- `POST /api/auth/logout`  
- `GET  /api/auth/me`

**Write operations (Sanctum auth required):**
- `POST /api/pages`
- `PUT  /api/pages/{id}`
- `DELETE /api/pages/{id}`

⚠️ Notes for Replit:  
- CMS API exists and works.  
- Need a new `/api/services` endpoint matching frontend structure.  
- Should autogenerate OpenAPI/Swagger doc for clarity.  

---

## 3.3. OTMS / Core Backend (Node.js + PostgreSQL)
**Domain:** https://opt.molochain.com  
**Path:**  
```
/var/www/vhosts/molochain.com/molochain-core/server
```

**Database:** PostgreSQL (`otms_db`)  
**Purpose:**  
- Logistics engine (shipments, containers, customs, operations)  
- REST APIs for operational modules  

⚠️ Notes for Replit:  
- Server exists but routing needs consolidation.  
- Needs cleanup: duplicate route files, service-layer separation.  
- Should migrate to a clean folder structure:  
```
server/
  api/
  core/
  services/
  database/
  utils/
```

---

# 4. Database Schemas (Structure Only)

## PostgreSQL — `otms_db`
Export available: `otms_schema.sql`

Contains tables for:  
- shipments  
- orders  
- containers  
- warehouses  
- carriers  
- tracking_events  
- invoices  
- documents  
- customers  
- tariffs  
- routes  
- schedules  

## MariaDB — `molochain_cms`
Export available: `cms_schema.sql`

Contains tables for:  
- pages  
- users  
- personal_access_tokens  
- filament_* tables  
- services (new model added)  

---

# 5. Folder Structure (Relevant Parts)

```
/var/www/vhosts/molochain.com/
│
├── httpdocs/                       → Live frontend build
├── molochain-core/
│   ├── client/                     → React/Vite SPA
│   ├── server/                     → Node API (OTMS)
│   └── dist/                       → Build output
│
└── cms.molochain.com/              → Laravel CMS
    ├── app/
    ├── routes/api.php
    ├── database/migrations
    ├── public/
```

---

# 6. Current Gaps (Replit Should Address)

### Frontend
- Services page still uses static `services.tsx`
- Needs live API integration from CMS: `/api/services`
- Bundle too large → needs optimization

### CMS
- `/api/services` route + controller not yet created  
- A clean Service DTO needed for frontend  
- Consider generating full API documentation

### Backend (Node)
- Multiple duplicated routes  
- Missing clear modular structure  
- Needs single entrypoint for all services (`/v1/…`)  
- Should include health monitoring endpoints  
- Needs environment-based configuration system  

---

# 7. What Replit Agent Is Expected To Do

1. **Align architecture** between Replit repo and server reality  
2. **Create missing CMS API endpoints** and unify formatting  
3. **Generate services API documentation automatically**  
4. **Refactor Node backend structure** so it matches clean conventions  
5. **Optimize frontend bundle**  
6. **Implement environment-based URLs**  
7. **Prepare deployment-ready folder structures**  
8. **(Optional)** create Docker or PM2 service definitions  

---

# 8. Security Notes
- No secrets or credentials included  
- Real secrets are stored in server `.env` files  
- Safe to share this file with Replit or external agents  

---

# 9. Summary for Replit

**This report describes:**

- Server specs  
- Installed tools  
- Directory layout  
- Available APIs  
- Missing components  
- Current backend inconsistencies  
- What exact tasks Replit must perform  

The goal is to **synchronize Replit project structure with production server architecture**, allowing smooth deployment and future scaling of MoloChain.